#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Secret detection (requires: pip install detect-secrets)
# Scans staged files and fails if new secrets are detected
if python -m detect_secrets --version >/dev/null 2>&1; then
  echo "Running secret detection..."
  STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -v 'package-lock.json\|\.snap$\|\.min\.js$' || true)
  if [ -n "$STAGED_FILES" ]; then
    # Scan staged files and compare against baseline
    echo "$STAGED_FILES" | xargs python -m detect_secrets scan --baseline .secrets.baseline 2>/dev/null
    if [ $? -ne 0 ]; then
      echo "âŒ Potential secrets detected! Run 'python -m detect_secrets audit .secrets.baseline' to review."
      exit 1
    fi
  fi
fi

npx lint-staged











